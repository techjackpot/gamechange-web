<div class="roll-calls-wrapper" *ngIf="loaded()">
	<div class="game-settings clearfix" *ngIf="currentClass.Weeks==1 && currentClass.Status=='Stopped'">
		<h3 class="widget-label text-center text-accent" style="margin-bottom: 1em;">Game Settings</h3>
	  <div class="form-group col-sm-4">
	    <label>User Collection Size</label>
	    <input type="number" class="form-control" placeholder="User Collection Size" name="CollectionSize" [(ngModel)]="currentClass.Player_CollectionSize" required>
	  </div>
	  <div class="form-group col-sm-4">
	    <label>Stack Size</label>
	    <input type="number" class="form-control" placeholder="Stack Size" name="StackSize" [(ngModel)]="currentClass.Player_StackSize" required>
	  </div>
	  <div class="form-group col-sm-4">
	    <label>Hand Size</label>
	    <input type="number" class="form-control" placeholder="Hand Size" name="HandSize" [(ngModel)]="currentClass.Player_HandSize" required>
	  </div>
	</div>
	<div class="roll-call-status">
		<h3 class="widget-label text-center text-accent" style="margin-bottom: 1em;">Game Status</h3>
		<div class="" style="margin-bottom: 10px;"><button class="btn btn-primary" (click)="startGameClicked()" [disabled]="currentClass.Status=='Started' || (currentClass.TotalWeeks==currentClass.Weeks && currentClass.Status=='Stopped')">Start</button> <button class="btn btn-danger" (click)="stopGameClicked()" [disabled]="currentClass.Status!='Started' || currentClass.TotalWeeks!=currentClass.Weeks">Stop</button> <button class="btn btn-warning" (click)="rollCallClicked()" [disabled]="currentClass.Status!='Started' || currentClass.TotalWeeks==currentClass.Weeks">Roll Call</button></div>
		<div class="text-large">Current Class Status: <span class="text-warn">{{currentClass.Status}}</span></div>
		<div class="text-large">Current Week: <span class="text-warn">{{currentClass.Weeks}} out of {{currentClass.TotalWeeks}}</span></div>
	</div>
	<div class="student-record-list" *ngIf="currentClass.Weeks!=1 ||currentClass.Status!='Stopped'">
		<h3 class="widget-label text-center text-accent" style="margin-bottom: 1em;">Student Record Book</h3>
		<div class="form-group col-sm-4 col-sm-offset-4">
			<label>Week</label>
			<select class="form-control" [(ngModel)]="week_studentbook" (change)="updateCurrentStudentBook()"><option *ngFor="let t of week_numbers;" [value]="t">{{ t }}</option></select>
		</div>
		<table class="student-book" *ngIf="marktypes.length>0 && currentClass && studentList.length>0 && studentBook.length>0">
			<tr>
				<td></td>
				<td>Attendance</td>
				<td *ngFor="let marktype of marktypes;">{{ marktype.Name }}</td>
				<td>Note</td>
			</tr>
			<tr *ngFor="let student_id of currentClass.Students;">
				<td><div class="profile_info"><img src="{{ getServerAssetUrl(studentList[getIndexOfUsers(studentList, student_id)].DisplayPicture) }}"><span>{{ studentList[getIndexOfUsers(studentList, student_id)].DisplayName }}</span></div></td>
				<td><input type="checkbox" [(ngModel)]="studentBook[getIndexOfMarkHistory(studentBook, student_id)].Attendance" /></td>
				<td *ngFor="let marktype of marktypes;"><input type="number" [(ngModel)]="studentBook[getIndexOfMarkHistory(studentBook, student_id)].Marks[getIndexOfMark(studentBook[getIndexOfMarkHistory(studentBook, student_id)].Marks, marktype._id)].Value" (mouseup)="$event.target.select()" /></td>
				<td><input type="text" [(ngModel)]="studentBook[getIndexOfMarkHistory(studentBook, student_id)].Note" /></td>
			</tr>
		</table>
		<div>
      <button class="btn btn-update" (click)="updateStudentBook()">Update Student Book{{loading}}</button>
    </div>
	</div>
	<div class="card-history-list" *ngIf="currentClass.CardHistory.length>0 && studentList.length>0 && cards.length>0">
		<h3 class="widget-label text-center text-accent" style="margin-bottom: 1em;">UnResolved Cards</h3>
		<div *ngFor="let history of currentClass.CardHistory;" class="card-history">
			<div *ngIf="history.UnResolved>0">
				<div class="card-preview-area">
					<div class="card-tile-preview">
						<h4 class="text-center">
							<span class="source">{{ studentList[getIndexOfUsers(studentList,history.Source)].DisplayName }}</span>
						</h4>
						<div class="card-tile {{ cards[getIndexOfCards(cards,history.Card)].Type | lowercase }}">
							<div class="card-title">
								<span>{{ cards[getIndexOfCards(cards,history.Card)].Title }}</span>
							</div>
							<div class="card-picture">
								<img class="card-picture-preview" src="{{ getServerAssetUrl(cards[getIndexOfCards(cards,history.Card)].Picture) }}">
							</div>
							<div class="card-description">
								<span>{{ cards[getIndexOfCards(cards,history.Card)].Description }}</span>
							</div>
							<div class="card-goldcost">
								<span>{{ cards[getIndexOfCards(cards,history.Card)].GoldCost }}</span>
							</div>
						</div>
						<div class="card-tile-actions" *ngFor="let action of cards[getIndexOfCards(cards,history.Card)].Actions; let ii=index;" [class.activated]="ii<history.Target.length-history.UnResolved">
							<div class="card-creation-action-form">
							  <div class="form-group">
							    <label>Keyword</label>
				    			<span>{{action.Keyword}}</span>
							  </div>
							  <div class="form-group">
							    <label>Target</label>
				    			<span>{{action.Target}}</span>
							  </div>
							  <div class="form-group">
							    <label>Target Value</label>
				    			<span>{{action.TargetValue}}</span>
							  </div>
							  <div class="form-group">
							    <label>Keyword Value</label>
				    			<span>{{action.KeywordValue}}</span>
							  </div>
							  <div class="form-group" *ngIf="action.Keyword=='Perform Action'">
							    <label>Action Description</label>
				    			<span>{{action.Description}}</span>
							  </div>
							</div>
						</div>
						<div class="confirm-actions">
							<button class="btn btn-confirm" (click)="confirmCardAction(history)">Confirm</button>
							<button class="btn btn-deny" (click)="denyCardAction(history)">Deny</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="set-bonus-to-player" *ngIf="(currentClass.Weeks!=1 || currentClass.Status!='Stopped') && (currentClass.Weeks!=currentClass.TotalWeeks || currentClass.Status!='Stopped')">
		<h3 class="widget-label text-center text-accent" style="margin-bottom: 1em;">Add Bonus to Player</h3>
		<div class="bonus-player-list">
			<div>Choose Player</div>
			<div class="players-list">
				<div class="bonus-player" *ngFor="let student of currentClass.Students;" (click)="choosePlayerToGiveBonus(student)" [class.selected]="selectedBonusPlayer==student">
					<div class="bonus-player-tile"><img src="{{ getServerAssetUrl(studentList[getIndexOfUsers(studentList,student)].DisplayPicture) }}"><span>{{ studentList[getIndexOfUsers(studentList,student)].DisplayName }}</span></div>
				</div>
			</div>
		</div>
		<div class="player-bonus-set" *ngIf="selectedBonusPlayer">
			<div class="bonus-set-card-list">
				<div>Choose Card</div>
				<div class="bonus-cards-list" *ngIf="cards.length>0">
					<div class="bonus-card" *ngFor="let card of cards">
						<div class="card-preview-area">
							<div class="card-tile-preview">
								<div class="card-tile {{ cards[getIndexOfCards(cards,card._id)].Type | lowercase }}" (click)="selectedPlayerBonusCard(card._id)" [class.selected]="playerBonusSet.Card==card._id">
									<div class="card-title">
										<span>{{ cards[getIndexOfCards(cards,card._id)].Title }}</span>
									</div>
									<div class="card-picture">
										<img class="card-picture-preview" src="{{ getServerAssetUrl(cards[getIndexOfCards(cards,card._id)].Picture) }}">
									</div>
									<div class="card-description">
										<span>{{ cards[getIndexOfCards(cards,card._id)].Description }}</span>
									</div>
									<div class="card-goldcost">
										<span>{{ cards[getIndexOfCards(cards,card._id)].GoldCost }}</span>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="bonus-set-point-gold clearfix">
			  <div class="form-group col-sm-4">
			    <label>Bonus Point</label>
			    <input type="number" class="form-control" placeholder="Bonus Point" name="BonusPoint" [(ngModel)]="playerBonusSet.Point" required>
			  </div>
			  <div class="form-group col-sm-4">
			    <label>Bonus Gold</label>
			    <input type="number" class="form-control" placeholder="Bonus Gold" name="BonusGold" [(ngModel)]="playerBonusSet.Gold" required>
			  </div>
			  <div class="col-sm-4 text-center">
			  	<div class="btn btn-give-bonus" (click)="givePlayerBonusSet()">Give Bonus</div>
			  </div>
			</div>
		</div>
	</div>
</div>